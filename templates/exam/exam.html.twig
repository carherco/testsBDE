{% extends 'base.html.twig' %}

{% block title %}Examen - {{ parent() }}{% endblock %}

{% block body %}
<div class="container py-4">
    <div class="card shadow p-4 mx-auto" style="max-width:1000px;">
        <h2 class="text-center mb-3">Examen - {{ tema.nombre }}</h2>
        {% if preguntas|length == 0 %}
            <p class="text-center">No hay preguntas en este tema. <a href="{{ path('app_home') }}">Volver</a></p>
        {% else %}
            <form action="{{ path('app_result') }}" method="post" id="examForm">
                <input type="hidden" name="tema" value="{{ tema.id }}">
                {% if tiempo > 0 %}
                    <div class="alert alert-info text-center" id="timerBox">
                        Tiempo restante: <span id="timer">{{ tiempo * 60 }}</span> segundos
                    </div>
                {% endif %}
                {% for pregunta in preguntas %}
                    <div class="mb-4">
                        <p><strong>{{ loop.index }}. {{ pregunta.texto }}</strong></p>
                        {% set opciones = ['a', 'b', 'c', 'd'] %}
                        {% for letra in opciones %}
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="p{{ pregunta.id }}" id="p{{ pregunta.id }}{{ letra }}" value="{{ letra }}" required>
                                <label class="form-check-label" for="p{{ pregunta.id }}{{ letra }}">{{ pregunta.getOpcion(letra) }}</label>
                            </div>
                        {% endfor %}
                    </div>
                    <hr>
                {% endfor %}
                <button type="submit" class="btn btn-success w-100 mt-3">Enviar examen</button>
            </form>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block javascripts %}
{% if tiempo > 0 %}
<script>
    let seconds = {{ tiempo * 60 }};
    const timerEl = document.getElementById('timer');
    const form = document.getElementById('examForm');
    function tick() {
        if (seconds <= 0) {
            if (form) form.submit();
            return;
        }
        seconds--;
        if (timerEl) timerEl.textContent = seconds;
        setTimeout(tick, 1000);
    }
    setTimeout(tick, 1000);
</script>
{% endif %}
{% endblock %}
